import TemplateVisitor from './template-visitor';
import JavaScriptCompiler from './javascript-compiler';
import { assert } from '@glimmer/util';
import { isLiteral, SyntaxError } from '@glimmer/syntax';
import { getAttrNamespace } from './utils';
import { SymbolAllocator } from './allocate-symbols';
function isTrustedValue(value) {
    return value.escaped !== undefined && !value.escaped;
}
export const THIS = 0;
export default class TemplateCompiler {
    constructor() {
        this.templateId = 0;
        this.templateIds = [];
        this.opcodes = [];
        this.includeMeta = false;
    }
    static compile(ast, options) {
        let templateVisitor = new TemplateVisitor();
        templateVisitor.visit(ast);
        let compiler = new TemplateCompiler();
        let opcodes = compiler.process(templateVisitor.actions);
        let symbols = new SymbolAllocator(opcodes).process();
        return JavaScriptCompiler.process(symbols, ast['symbols'], options);
    }
    process(actions) {
        actions.forEach(([name, ...args]) => {
            if (!this[name]) {
                throw new Error(`Unimplemented ${name} on TemplateCompiler`);
            }
            this[name](...args);
        });
        return this.opcodes;
    }
    startProgram([program]) {
        this.opcode(['startProgram', program], program);
    }
    endProgram() {
        this.opcode(['endProgram', null], null);
    }
    startBlock([program]) {
        this.templateId++;
        this.opcode(['startBlock', program], program);
    }
    endBlock() {
        this.templateIds.push(this.templateId - 1);
        this.opcode(['endBlock', null], null);
    }
    text([action]) {
        this.opcode(['text', action.chars], action);
    }
    comment([action]) {
        this.opcode(['comment', action.value], action);
    }
    openElement([action]) {
        let attributes = action.attributes;
        let hasSplat;
        for (let i = 0; i < attributes.length; i++) {
            let attr = attributes[i];
            if (attr.name === '...attributes') {
                hasSplat = attr;
                break;
            }
        }
        if (isDynamicComponent(action)) {
            let head, rest;
            [head, ...rest] = action.tag.split('.');
            if (head === 'this') {
                head = 0;
            }
            this.opcode(['get', [head, rest]]);
            this.opcode(['openComponent', action], action);
        } else if (isComponent(action)) {
            this.opcode(['openComponent', action], action);
        } else if (hasSplat) {
            this.opcode(['openSplattedElement', action], action);
        } else {
            this.opcode(['openElement', action], action);
        }
        let typeAttr = null;
        let attrs = action.attributes;
        for (let i = 0; i < attrs.length; i++) {
            if (attrs[i].name === 'type') {
                typeAttr = attrs[i];
                continue;
            }
            this.attribute([attrs[i]]);
        }
        if (typeAttr) {
            this.attribute([typeAttr]);
        }
        this.opcode(['flushElement', action], null);
    }
    closeElement([action]) {
        if (isDynamicComponent(action)) {
            this.opcode(['closeDynamicComponent', action], action);
        } else if (isComponent(action)) {
            this.opcode(['closeComponent', action], action);
        } else if (action.modifiers.length > 0) {
            for (let i = 0; i < action.modifiers.length; i++) {
                this.modifier([action.modifiers[i]]);
            }
            this.opcode(['closeElement', action], action);
        } else {
            this.opcode(['closeElement', action], action);
        }
    }
    attribute([action]) {
        let { name, value } = action;
        let namespace = getAttrNamespace(name);
        let isStatic = this.prepareAttributeValue(value);
        if (name.charAt(0) === '@') {
            // Arguments
            if (isStatic) {
                this.opcode(['staticArg', name], action);
            } else if (action.value.type === 'MustacheStatement') {
                this.opcode(['dynamicArg', name], action);
            } else {
                this.opcode(['dynamicArg', name], action);
            }
        } else {
            let isTrusting = isTrustedValue(value);
            if (isStatic && name === '...attributes') {
                this.opcode(['attrSplat', null], action);
            } else if (isStatic) {
                this.opcode(['staticAttr', [name, namespace]], action);
            } else if (isTrusting) {
                this.opcode(['trustingAttr', [name, namespace]], action);
            } else if (action.value.type === 'MustacheStatement') {
                this.opcode(['dynamicAttr', [name, null]], action);
            } else {
                this.opcode(['dynamicAttr', [name, namespace]], action);
            }
        }
    }
    modifier([action]) {
        assertIsSimplePath(action.path, action.loc, 'modifier');
        let { path: { parts } } = action;
        this.prepareHelper(action);
        this.opcode(['modifier', parts[0]], action);
    }
    mustache([action]) {
        let { path } = action;
        if (isLiteral(path)) {
            this.mustacheExpression(action);
            this.opcode(['append', !action.escaped], action);
        } else if (isYield(path)) {
            let to = assertValidYield(action);
            this.yield(to, action);
        } else if (isPartial(path)) {
            let params = assertValidPartial(action);
            this.partial(params, action);
        } else if (isDebugger(path)) {
            assertValidDebuggerUsage(action);
            this.debugger('debugger', action);
        } else {
            this.mustacheExpression(action);
            this.opcode(['append', !action.escaped], action);
        }
    }
    block([action /*, index, count*/]) {
        this.prepareHelper(action);
        let templateId = this.templateIds.pop();
        let inverseId = action.inverse === null ? null : this.templateIds.pop();
        this.opcode(['block', [action.path.parts[0], templateId, inverseId]], action);
    }
    /// Internal actions, not found in the original processed actions
    arg([path]) {
        let { parts: [head, ...rest] } = path;
        this.opcode(['get', [`@${head}`, rest]], path);
    }
    mustacheExpression(expr) {
        let { path } = expr;
        if (isLiteral(path)) {
            this.opcode(['literal', path.value], expr);
        } else if (isBuiltInHelper(path)) {
            this.builtInHelper(expr);
        } else if (isArg(path)) {
            this.arg([path]);
        } else if (isHelperInvocation(expr)) {
            this.prepareHelper(expr);
            this.opcode(['helper', path.parts[0]], expr);
        } else if (path.this) {
            this.opcode(['get', [0, path.parts]], expr);
        } else {
            let [head, ...parts] = path.parts;
            this.opcode(['maybeGet', [head, parts]], expr);
        }
        // } else if (isLocal(path, this.symbols)) {
        //   let [head, ...parts] = path.parts;
        //   this.opcode(['get', [head, parts]], expr);
        // } else if (isSimplePath(path)) {
        //   this.opcode(['unknown', path.parts[0]], expr);
        // } else {
        //   this.opcode(['maybeLocal', path.parts], expr);
        // }
    }
    /// Internal Syntax
    yield(to, action) {
        this.prepareParams(action.params);
        this.opcode(['yield', to], action);
    }
    debugger(_name, action) {
        this.opcode(['debugger', null], action);
    }
    hasBlock(name, action) {
        this.opcode(['hasBlock', name], action);
    }
    hasBlockParams(name, action) {
        this.opcode(['hasBlockParams', name], action);
    }
    partial(_params, action) {
        this.prepareParams(action.params);
        this.opcode(['partial', null], action);
    }
    builtInHelper(expr) {
        let { path } = expr;
        if (isHasBlock(path)) {
            let name = assertValidHasBlockUsage(expr.path.original, expr);
            this.hasBlock(name, expr);
        } else if (isHasBlockParams(path)) {
            let name = assertValidHasBlockUsage(expr.path.original, expr);
            this.hasBlockParams(name, expr);
        }
    }
    /// Expressions, invoked recursively from prepareParams and prepareHash
    SubExpression(expr) {
        if (isBuiltInHelper(expr.path)) {
            this.builtInHelper(expr);
        } else {
            this.prepareHelper(expr);
            this.opcode(['helper', expr.path.parts[0]], expr);
        }
    }
    PathExpression(expr) {
        if (expr.data) {
            this.arg([expr]);
        } else {
            let [head, ...rest] = expr.parts;
            if (expr.this) {
                this.opcode(['get', [0, expr.parts]], expr);
            } else {
                this.opcode(['get', [head, rest]], expr);
            }
        }
    }
    StringLiteral(action) {
        this.opcode(['literal', action.value], action);
    }
    BooleanLiteral(action) {
        this.opcode(['literal', action.value], action);
    }
    NumberLiteral(action) {
        this.opcode(['literal', action.value], action);
    }
    NullLiteral(action) {
        this.opcode(['literal', action.value], action);
    }
    UndefinedLiteral(action) {
        this.opcode(['literal', action.value], action);
    }
    /// Utilities
    opcode(opcode, action = null) {
        // TODO: This doesn't really work
        if (this.includeMeta && action) {
            opcode.push(this.meta(action));
        }
        this.opcodes.push(opcode);
    }
    prepareHelper(expr) {
        assertIsSimplePath(expr.path, expr.loc, 'helper');
        let { params, hash } = expr;
        this.prepareHash(hash);
        this.prepareParams(params);
    }
    prepareParams(params) {
        if (!params.length) {
            this.opcode(['literal', null], null);
            return;
        }
        for (let i = params.length - 1; i >= 0; i--) {
            let param = params[i];
            (false && assert(this[param.type], `Unimplemented ${param.type} on TemplateCompiler`));

            this[param.type](param);
        }
        this.opcode(['prepareArray', params.length], null);
    }
    prepareHash(hash) {
        let pairs = hash.pairs;
        if (!pairs.length) {
            this.opcode(['literal', null], null);
            return;
        }
        for (let i = pairs.length - 1; i >= 0; i--) {
            let { key, value } = pairs[i];
            (false && assert(this[value.type], `Unimplemented ${value.type} on TemplateCompiler`));

            this[value.type](value);
            this.opcode(['literal', key], null);
        }
        this.opcode(['prepareObject', pairs.length], null);
    }
    prepareAttributeValue(value) {
        // returns the static value if the value is static
        switch (value.type) {
            case 'TextNode':
                this.opcode(['literal', value.chars], value);
                return true;
            case 'MustacheStatement':
                this.attributeMustache([value]);
                return false;
            case 'ConcatStatement':
                this.prepareConcatParts(value.parts);
                this.opcode(['concat', null], value);
                return false;
        }
    }
    prepareConcatParts(parts) {
        for (let i = parts.length - 1; i >= 0; i--) {
            let part = parts[i];
            if (part.type === 'MustacheStatement') {
                this.attributeMustache([part]);
            } else if (part.type === 'TextNode') {
                this.opcode(['literal', part.chars], null);
            }
        }
        this.opcode(['prepareArray', parts.length], null);
    }
    attributeMustache([action]) {
        this.mustacheExpression(action);
    }
    meta(node) {
        let loc = node.loc;
        if (!loc) {
            return [];
        }
        let { source, start, end } = loc;
        return ['loc', [source || null, [start.line, start.column], [end.line, end.column]]];
    }
}
function isHelperInvocation(mustache) {
    return mustache.params && mustache.params.length > 0 || mustache.hash && mustache.hash.pairs.length > 0;
}
function isSimplePath({ parts }) {
    return parts.length === 1;
}
function isYield(path) {
    return path.original === 'yield';
}
function isPartial(path) {
    return path.original === 'partial';
}
function isDebugger(path) {
    return path.original === 'debugger';
}
function isHasBlock(path) {
    return path.original === 'has-block';
}
function isHasBlockParams(path) {
    return path.original === 'has-block-params';
}
function isBuiltInHelper(path) {
    return isHasBlock(path) || isHasBlockParams(path);
}
function isArg(path) {
    return !!path['data'];
}
function isDynamicComponent(element) {
    let open = element.tag.charAt(0);
    let [maybeLocal] = element.tag.split('.');
    let isNamedArgument = open === '@';
    let isLocal = element['symbols'].has(maybeLocal);
    let isThisPath = element.tag.indexOf('this.') === 0;
    return isLocal || isNamedArgument || isThisPath;
}
function isComponent(element) {
    let open = element.tag.charAt(0);
    let isPath = element.tag.indexOf('.') > -1;
    let isUpperCase = open === open.toUpperCase() && open !== open.toLowerCase();
    return isUpperCase && !isPath || isDynamicComponent(element);
}
function assertIsSimplePath(path, loc, context) {
    if (!isSimplePath(path)) {
        throw new SyntaxError(`\`${path.original}\` is not a valid name for a ${context} on line ${loc.start.line}.`, path.loc);
    }
}
function assertValidYield(statement) {
    let { pairs } = statement.hash;
    if (pairs.length === 1 && pairs[0].key !== 'to' || pairs.length > 1) {
        throw new SyntaxError(`yield only takes a single named argument: 'to'`, statement.loc);
    } else if (pairs.length === 1 && pairs[0].value.type !== 'StringLiteral') {
        throw new SyntaxError(`you can only yield to a literal value`, statement.loc);
    } else if (pairs.length === 0) {
        return 'default';
    } else {
        return pairs[0].value.value;
    }
}
function assertValidPartial(statement) {
    let { params, hash, escaped, loc } = statement;
    if (params && params.length !== 1) {
        throw new SyntaxError(`Partial found with no arguments. You must specify a template name. (on line ${loc.start.line})`, statement.loc);
    } else if (hash && hash.pairs.length > 0) {
        throw new SyntaxError(`partial does not take any named arguments (on line ${loc.start.line})`, statement.loc);
    } else if (!escaped) {
        throw new SyntaxError(`{{{partial ...}}} is not supported, please use {{partial ...}} instead (on line ${loc.start.line})`, statement.loc);
    }
    return params;
}
function assertValidHasBlockUsage(type, call) {
    let { params, hash, loc } = call;
    if (hash && hash.pairs.length > 0) {
        throw new SyntaxError(`${type} does not take any named arguments`, call.loc);
    }
    if (params.length === 0) {
        return 'default';
    } else if (params.length === 1) {
        let param = params[0];
        if (param.type === 'StringLiteral') {
            return param.value;
        } else {
            throw new SyntaxError(`you can only yield to a literal value (on line ${loc.start.line})`, call.loc);
        }
    } else {
        throw new SyntaxError(`${type} only takes a single positional argument (on line ${loc.start.line})`, call.loc);
    }
}
function assertValidDebuggerUsage(statement) {
    let { params, hash } = statement;
    if (hash && hash.pairs.length > 0) {
        throw new SyntaxError(`debugger does not take any named arguments`, statement.loc);
    }
    if (params.length === 0) {
        return 'default';
    } else {
        throw new SyntaxError(`debugger does not take any positional arguments`, statement.loc);
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVtcGxhdGUtY29tcGlsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wYWNrYWdlcy9AZ2xpbW1lci9jb21waWxlci9saWIvdGVtcGxhdGUtY29tcGlsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxBQUEyQixxQkFBTSxBQUFvQixBQUFDO0FBQzdELE9BQU8sQUFBZ0Msd0JBQU0sQUFBdUIsQUFBQztBQUNyRSxBQUFPLFNBQUUsQUFBTSxBQUFVLGNBQU0sQUFBZSxBQUFDO0FBQy9DLEFBQU8sU0FBTyxBQUFTLFdBQUUsQUFBVyxBQUFFLG1CQUFNLEFBQWlCLEFBQUM7QUFDOUQsQUFBTyxTQUFFLEFBQWdCLEFBQUUsd0JBQU0sQUFBUyxBQUFDO0FBRTNDLEFBQU8sU0FBRSxBQUFlLEFBQTRDLHVCQUFNLEFBQW9CLEFBQUM7QUFRL0Ysd0JBQXdCLEFBQVU7QUFDaEMsV0FBTyxBQUFLLE1BQUMsQUFBTyxZQUFLLEFBQVMsYUFBSSxDQUFDLEFBQUssTUFBQyxBQUFPLEFBQUMsQUFDdkQ7QUFBQztBQUVELEFBQU0sT0FBQyxNQUFNLEFBQUksT0FBRyxBQUFDLEFBQUM7QUFFdEIsQUFBTSxBQUFDLEFBQU87QUFBZDtBQVlVLGFBQVUsYUFBRyxBQUFDLEFBQUM7QUFDZixhQUFXLGNBQWEsQUFBRSxBQUFDO0FBQzNCLGFBQU8sVUFBaUIsQUFBRSxBQUFDO0FBQzNCLGFBQVcsY0FBRyxBQUFLLEFBQUMsQUFtWTlCO0FBQUM7QUFqWkMsQUFBTSxXQUFDLEFBQU8sUUFBQyxBQUFnQixLQUFFLEFBQXdCO0FBQ3ZELFlBQUksQUFBZSxrQkFBRyxJQUFJLEFBQWUsQUFBRSxBQUFDO0FBQzVDLEFBQWUsd0JBQUMsQUFBSyxNQUFDLEFBQUcsQUFBQyxBQUFDO0FBRTNCLFlBQUksQUFBUSxXQUFHLElBQUksQUFBZ0IsQUFBRSxBQUFDO0FBQ3RDLFlBQUksQUFBTyxVQUFpQixBQUFRLFNBQUMsQUFBTyxRQUFDLEFBQWUs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LElBQUMsQUFBSyxNQUFDLEFBQUksSUFBRyxLQUNuRSxBQUFJLEtBQUMsQUFBRyxBQUNULEFBQUM7QUFDSDtBQUNGLEtBVk0sTUFVQTtBQUNMLGNBQU0sSUFBSSxBQUFXLEFBQ25CLGVBQUcsQUFBSSx5REFBcUQsQUFBRyxJQUFDLEFBQUssTUFBQyxBQUFJLElBQUcsS0FDN0UsQUFBSSxLQUFDLEFBQUcsQUFDVCxBQUFDO0FBQ0gsQUFDSDtBQUFDO0FBRUQsa0NBQWtDLEFBQWdDO0FBQ2hFLFFBQUksRUFBRSxBQUFNLFFBQUUsQUFBSSxBQUFFLFNBQUcsQUFBUyxBQUFDO0FBRWpDLFFBQUksQUFBSSxRQUFJLEFBQUksS0FBQyxBQUFLLE1BQUMsQUFBTSxTQUFHLEFBQUMsR0FBRTtBQUNqQyxjQUFNLElBQUksQUFBVyxBQUFDLFlBQTRDLDhDQUFFLEFBQVMsVUFBQyxBQUFHLEFBQUMsQUFBQztBQUNwRjtBQUVELFFBQUksQUFBTSxPQUFDLEFBQU0sV0FBSyxBQUFDLEdBQUU7QUFDdkIsZUFBTyxBQUFTLEFBQUM7QUFDbEIsV0FBTTtBQUNMLGNBQU0sSUFBSSxBQUFXLEFBQUMsWUFBaUQsbURBQUUsQUFBUyxVQUFDLEFBQUcsQUFBQyxBQUFDO0FBQ3pGLEFBQ0g7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBUZW1wbGF0ZVZpc2l0b3IsIHsgQWN0aW9uIH0gZnJvbSAnLi90ZW1wbGF0ZS12aXNpdG9yJztcbmltcG9ydCBKYXZhU2NyaXB0Q29tcGlsZXIsIHsgVGVtcGxhdGUgfSBmcm9tICcuL2phdmFzY3JpcHQtY29tcGlsZXInO1xuaW1wb3J0IHsgYXNzZXJ0LCBPcHRpb24gfSBmcm9tICdAZ2xpbW1lci91dGlsJztcbmltcG9ydCB7IEFTVCwgaXNMaXRlcmFsLCBTeW50YXhFcnJvciB9IGZyb20gJ0BnbGltbWVyL3N5bnRheCc7XG5pbXBvcnQgeyBnZXRBdHRyTmFtZXNwYWNlIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyBPcGFxdWUgfSBmcm9tICdAZ2xpbW1lci9pbnRlcmZhY2VzJztcbmltcG9ydCB7IFN5bWJvbEFsbG9jYXRvciwgSW5PcCBhcyBTeW1ib2xJbk9wLCBPdXRPcCBhcyBTeW1ib2xPdXRPcCB9IGZyb20gJy4vYWxsb2NhdGUtc3ltYm9scyc7XG5pbXBvcnQgeyBQYXRoSGVhZCB9IGZyb20gJy4vY29tcGlsZXItb3BzJztcblxuZXhwb3J0IGludGVyZmFjZSBDb21waWxlT3B0aW9ucyB7XG4gIG1ldGE6IE9wYXF1ZTtcbiAgY3VzdG9taXplQ29tcG9uZW50TmFtZT8odGFnOiBzdHJpbmcpOiBzdHJpbmc7XG59XG5cbmZ1bmN0aW9uIGlzVHJ1c3RlZFZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgcmV0dXJuIHZhbHVlLmVzY2FwZWQgIT09IHVuZGVmaW5lZCAmJiAhdmFsdWUuZXNjYXBlZDtcbn1cblxuZXhwb3J0IGNvbnN0IFRISVMgPSAwO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUZW1wbGF0ZUNvbXBpbGVyIHtcbiAgc3RhdGljIGNvbXBpbGUoYXN0OiBBU1QuUHJvZ3JhbSwgb3B0aW9ucz86IENvbXBpbGVPcHRpb25zKTogVGVtcGxhdGUge1xuICAgIGxldCB0ZW1wbGF0ZVZpc2l0b3IgPSBuZXcgVGVtcGxhdGVWaXNpdG9yKCk7XG4gICAgdGVtcGxhdGVWaXNpdG9yLnZpc2l0KGFzdCk7XG5cbiAgICBsZXQgY29tcGlsZXIgPSBuZXcgVGVtcGxhdGVDb21waWxlcigpO1xuICAgIGxldCBvcGNvZGVzOiBTeW1ib2xJbk9wW10gPSBjb21waWxlci5wcm9jZXNzKHRlbXBsYXRlVmlzaXRvci5hY3Rpb25zKTtcbiAgICBsZXQgc3ltYm9sczogU3ltYm9sT3V0T3BbXSA9IG5ldyBTeW1ib2xBbGxvY2F0b3Iob3Bjb2RlcykucHJvY2VzcygpO1xuXG4gICAgcmV0dXJuIEphdmFTY3JpcHRDb21waWxlci5wcm9jZXNzKHN5bWJvbHMsIGFzdFsnc3ltYm9scyddLCBvcHRpb25zKTtcbiAgfVxuXG4gIHByaXZhdGUgdGVtcGxhdGVJZCA9IDA7XG4gIHByaXZhdGUgdGVtcGxhdGVJZHM6IG51bWJlcltdID0gW107XG4gIHByaXZhdGUgb3Bjb2RlczogU3ltYm9sSW5PcFtdID0gW107XG4gIHByaXZhdGUgaW5jbHVkZU1ldGEgPSBmYWxzZTtcblxuICBwcm9jZXNzKGFjdGlvbnM6IEFjdGlvbltdKTogU3ltYm9sSW5PcFtdIHtcbiAgICBhY3Rpb25zLmZvckVhY2goKFtuYW1lLCAuLi5hcmdzXSkgPT4ge1xuICAgICAgaWYgKCF0aGlzW25hbWVdKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5pbXBsZW1lbnRlZCAke25hbWV9IG9uIFRlbXBsYXRlQ29tcGlsZXJgKTtcbiAgICAgIH1cbiAgICAgICh0aGlzW25hbWVdIGFzIGFueSkoLi4uYXJncyk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXMub3Bjb2RlcztcbiAgfVxuXG4gIHN0YXJ0UHJvZ3JhbShbcHJvZ3JhbV06IFtBU1QuUHJvZ3JhbV0pIHtcbiAgICB0aGlzLm9wY29kZShbJ3N0YXJ0UHJvZ3JhbScsIHByb2dyYW1dLCBwcm9ncmFtKTtcbiAgfVxuXG4gIGVuZFByb2dyYW0oKSB7XG4gICAgdGhpcy5vcGNvZGUoWydlbmRQcm9ncmFtJywgbnVsbF0sIG51bGwpO1xuICB9XG5cbiAgc3RhcnRCbG9jayhbcHJvZ3JhbV06IFtBU1QuUHJvZ3JhbV0pIHtcbiAgICB0aGlzLnRlbXBsYXRlSWQrKztcbiAgICB0aGlzLm9wY29kZShbJ3N0YXJ0QmxvY2snLCBwcm9ncmFtXSwgcHJvZ3JhbSk7XG4gIH1cblxuICBlbmRCbG9jaygpIHtcbiAgICB0aGlzLnRlbXBsYXRlSWRzLnB1c2godGhpcy50ZW1wbGF0ZUlkIC0gMSk7XG4gICAgdGhpcy5vcGNvZGUoWydlbmRCbG9jaycsIG51bGxdLCBudWxsKTtcbiAgfVxuXG4gIHRleHQoW2FjdGlvbl06IFtBU1QuVGV4dE5vZGVdKSB7XG4gICAgdGhpcy5vcGNvZGUoWyd0ZXh0JywgYWN0aW9uLmNoYXJzXSwgYWN0aW9uKTtcbiAgfVxuXG4gIGNvbW1lbnQoW2FjdGlvbl06IFtBU1QuQ29tbWVudFN0YXRlbWVudF0pIHtcbiAgICB0aGlzLm9wY29kZShbJ2NvbW1lbnQnLCBhY3Rpb24udmFsdWVdLCBhY3Rpb24pO1xuICB9XG5cbiAgb3BlbkVsZW1lbnQoW2FjdGlvbl06IFtBU1QuRWxlbWVudE5vZGVdKSB7XG4gICAgbGV0IGF0dHJpYnV0ZXMgPSBhY3Rpb24uYXR0cmlidXRlcztcbiAgICBsZXQgaGFzU3BsYXQ7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBhdHRyID0gYXR0cmlidXRlc1tpXTtcbiAgICAgIGlmIChhdHRyLm5hbWUgPT09ICcuLi5hdHRyaWJ1dGVzJykge1xuICAgICAgICBoYXNTcGxhdCA9IGF0dHI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpc0R5bmFtaWNDb21wb25lbnQoYWN0aW9uKSkge1xuICAgICAgbGV0IGhlYWQ6IFBhdGhIZWFkLCByZXN0OiBzdHJpbmdbXTtcbiAgICAgIFtoZWFkLCAuLi5yZXN0XSA9IGFjdGlvbi50YWcuc3BsaXQoJy4nKTtcbiAgICAgIGlmIChoZWFkID09PSAndGhpcycpIHtcbiAgICAgICAgaGVhZCA9IDA7XG4gICAgICB9XG4gICAgICB0aGlzLm9wY29kZShbJ2dldCcsIFtoZWFkLCByZXN0XV0pO1xuICAgICAgdGhpcy5vcGNvZGUoWydvcGVuQ29tcG9uZW50JywgYWN0aW9uXSwgYWN0aW9uKTtcbiAgICB9IGVsc2UgaWYgKGlzQ29tcG9uZW50KGFjdGlvbikpIHtcbiAgICAgIHRoaXMub3Bjb2RlKFsnb3BlbkNvbXBvbmVudCcsIGFjdGlvbl0sIGFjdGlvbik7XG4gICAgfSBlbHNlIGlmIChoYXNTcGxhdCkge1xuICAgICAgdGhpcy5vcGNvZGUoWydvcGVuU3BsYXR0ZWRFbGVtZW50JywgYWN0aW9uXSwgYWN0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5vcGNvZGUoWydvcGVuRWxlbWVudCcsIGFjdGlvbl0sIGFjdGlvbik7XG4gICAgfVxuXG4gICAgbGV0IHR5cGVBdHRyOiBPcHRpb248QVNULkF0dHJOb2RlPiA9IG51bGw7XG4gICAgbGV0IGF0dHJzID0gYWN0aW9uLmF0dHJpYnV0ZXM7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhdHRycy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGF0dHJzW2ldLm5hbWUgPT09ICd0eXBlJykge1xuICAgICAgICB0eXBlQXR0ciA9IGF0dHJzW2ldO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuYXR0cmlidXRlKFthdHRyc1tpXV0pO1xuICAgIH1cblxuICAgIGlmICh0eXBlQXR0cikge1xuICAgICAgdGhpcy5hdHRyaWJ1dGUoW3R5cGVBdHRyXSk7XG4gICAgfVxuXG4gICAgdGhpcy5vcGNvZGUoWydmbHVzaEVsZW1lbnQnLCBhY3Rpb25dLCBudWxsKTtcbiAgfVxuXG4gIGNsb3NlRWxlbWVudChbYWN0aW9uXTogW0FTVC5FbGVtZW50Tm9kZV0pIHtcbiAgICBpZiAoaXNEeW5hbWljQ29tcG9uZW50KGFjdGlvbikpIHtcbiAgICAgIHRoaXMub3Bjb2RlKFsnY2xvc2VEeW5hbWljQ29tcG9uZW50JywgYWN0aW9uXSwgYWN0aW9uKTtcbiAgICB9IGVsc2UgaWYgKGlzQ29tcG9uZW50KGFjdGlvbikpIHtcbiAgICAgIHRoaXMub3Bjb2RlKFsnY2xvc2VDb21wb25lbnQnLCBhY3Rpb25dLCBhY3Rpb24pO1xuICAgIH0gZWxzZSBpZiAoYWN0aW9uLm1vZGlmaWVycy5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFjdGlvbi5tb2RpZmllcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdGhpcy5tb2RpZmllcihbYWN0aW9uLm1vZGlmaWVyc1tpXV0pO1xuICAgICAgfVxuICAgICAgdGhpcy5vcGNvZGUoWydjbG9zZUVsZW1lbnQnLCBhY3Rpb25dLCBhY3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9wY29kZShbJ2Nsb3NlRWxlbWVudCcsIGFjdGlvbl0sIGFjdGlvbik7XG4gICAgfVxuICB9XG5cbiAgYXR0cmlidXRlKFthY3Rpb25dOiBbQVNULkF0dHJOb2RlXSkge1xuICAgIGxldCB7IG5hbWUsIHZhbHVlIH0gPSBhY3Rpb247XG5cbiAgICBsZXQgbmFtZXNwYWNlID0gZ2V0QXR0ck5hbWVzcGFjZShuYW1lKTtcblxuICAgIGxldCBpc1N0YXRpYyA9IHRoaXMucHJlcGFyZUF0dHJpYnV0ZVZhbHVlKHZhbHVlKTtcblxuICAgIGlmIChuYW1lLmNoYXJBdCgwKSA9PT0gJ0AnKSB7XG4gICAgICAvLyBBcmd1bWVudHNcbiAgICAgIGlmIChpc1N0YXRpYykge1xuICAgICAgICB0aGlzLm9wY29kZShbJ3N0YXRpY0FyZycsIG5hbWVdLCBhY3Rpb24pO1xuICAgICAgfSBlbHNlIGlmIChhY3Rpb24udmFsdWUudHlwZSA9PT0gJ011c3RhY2hlU3RhdGVtZW50Jykge1xuICAgICAgICB0aGlzLm9wY29kZShbJ2R5bmFtaWNBcmcnLCBuYW1lXSwgYWN0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKFsnZHluYW1pY0FyZycsIG5hbWVdLCBhY3Rpb24pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgaXNUcnVzdGluZyA9IGlzVHJ1c3RlZFZhbHVlKHZhbHVlKTtcblxuICAgICAgaWYgKGlzU3RhdGljICYmIG5hbWUgPT09ICcuLi5hdHRyaWJ1dGVzJykge1xuICAgICAgICB0aGlzLm9wY29kZShbJ2F0dHJTcGxhdCcsIG51bGxdLCBhY3Rpb24pO1xuICAgICAgfSBlbHNlIGlmIChpc1N0YXRpYykge1xuICAgICAgICB0aGlzLm9wY29kZShbJ3N0YXRpY0F0dHInLCBbbmFtZSwgbmFtZXNwYWNlXV0sIGFjdGlvbik7XG4gICAgICB9IGVsc2UgaWYgKGlzVHJ1c3RpbmcpIHtcbiAgICAgICAgdGhpcy5vcGNvZGUoWyd0cnVzdGluZ0F0dHInLCBbbmFtZSwgbmFtZXNwYWNlXV0sIGFjdGlvbik7XG4gICAgICB9IGVsc2UgaWYgKGFjdGlvbi52YWx1ZS50eXBlID09PSAnTXVzdGFjaGVTdGF0ZW1lbnQnKSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKFsnZHluYW1pY0F0dHInLCBbbmFtZSwgbnVsbF1dLCBhY3Rpb24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5vcGNvZGUoWydkeW5hbWljQXR0cicsIFtuYW1lLCBuYW1lc3BhY2VdXSwgYWN0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBtb2RpZmllcihbYWN0aW9uXTogW0FTVC5FbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnRdKSB7XG4gICAgYXNzZXJ0SXNTaW1wbGVQYXRoKGFjdGlvbi5wYXRoLCBhY3Rpb24ubG9jLCAnbW9kaWZpZXInKTtcblxuICAgIGxldCB7XG4gICAgICBwYXRoOiB7IHBhcnRzIH0sXG4gICAgfSA9IGFjdGlvbjtcblxuICAgIHRoaXMucHJlcGFyZUhlbHBlcihhY3Rpb24pO1xuICAgIHRoaXMub3Bjb2RlKFsnbW9kaWZpZXInLCBwYXJ0c1swXV0sIGFjdGlvbik7XG4gIH1cblxuICBtdXN0YWNoZShbYWN0aW9uXTogW0FTVC5NdXN0YWNoZVN0YXRlbWVudF0pIHtcbiAgICBsZXQgeyBwYXRoIH0gPSBhY3Rpb247XG5cbiAgICBpZiAoaXNMaXRlcmFsKHBhdGgpKSB7XG4gICAgICB0aGlzLm11c3RhY2hlRXhwcmVzc2lvbihhY3Rpb24pO1xuICAgICAgdGhpcy5vcGNvZGUoWydhcHBlbmQnLCAhYWN0aW9uLmVzY2FwZWRdLCBhY3Rpb24pO1xuICAgIH0gZWxzZSBpZiAoaXNZaWVsZChwYXRoKSkge1xuICAgICAgbGV0IHRvID0gYXNzZXJ0VmFsaWRZaWVsZChhY3Rpb24pO1xuICAgICAgdGhpcy55aWVsZCh0bywgYWN0aW9uKTtcbiAgICB9IGVsc2UgaWYgKGlzUGFydGlhbChwYXRoKSkge1xuICAgICAgbGV0IHBhcmFtcyA9IGFzc2VydFZhbGlkUGFydGlhbChhY3Rpb24pO1xuICAgICAgdGhpcy5wYXJ0aWFsKHBhcmFtcywgYWN0aW9uKTtcbiAgICB9IGVsc2UgaWYgKGlzRGVidWdnZXIocGF0aCkpIHtcbiAgICAgIGFzc2VydFZhbGlkRGVidWdnZXJVc2FnZShhY3Rpb24pO1xuICAgICAgdGhpcy5kZWJ1Z2dlcignZGVidWdnZXInLCBhY3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm11c3RhY2hlRXhwcmVzc2lvbihhY3Rpb24pO1xuICAgICAgdGhpcy5vcGNvZGUoWydhcHBlbmQnLCAhYWN0aW9uLmVzY2FwZWRdLCBhY3Rpb24pO1xuICAgIH1cbiAgfVxuXG4gIGJsb2NrKFthY3Rpb24gLyosIGluZGV4LCBjb3VudCovXTogW0FTVC5CbG9ja1N0YXRlbWVudF0pIHtcbiAgICB0aGlzLnByZXBhcmVIZWxwZXIoYWN0aW9uKTtcbiAgICBsZXQgdGVtcGxhdGVJZCA9IHRoaXMudGVtcGxhdGVJZHMucG9wKCkhO1xuICAgIGxldCBpbnZlcnNlSWQgPSBhY3Rpb24uaW52ZXJzZSA9PT0gbnVsbCA/IG51bGwgOiB0aGlzLnRlbXBsYXRlSWRzLnBvcCgpITtcbiAgICB0aGlzLm9wY29kZShbJ2Jsb2NrJywgW2FjdGlvbi5wYXRoLnBhcnRzWzBdLCB0ZW1wbGF0ZUlkLCBpbnZlcnNlSWRdXSwgYWN0aW9uKTtcbiAgfVxuXG4gIC8vLyBJbnRlcm5hbCBhY3Rpb25zLCBub3QgZm91bmQgaW4gdGhlIG9yaWdpbmFsIHByb2Nlc3NlZCBhY3Rpb25zXG5cbiAgYXJnKFtwYXRoXTogW0FTVC5QYXRoRXhwcmVzc2lvbl0pIHtcbiAgICBsZXQge1xuICAgICAgcGFydHM6IFtoZWFkLCAuLi5yZXN0XSxcbiAgICB9ID0gcGF0aDtcbiAgICB0aGlzLm9wY29kZShbJ2dldCcsIFtgQCR7aGVhZH1gLCByZXN0XV0sIHBhdGgpO1xuICB9XG5cbiAgbXVzdGFjaGVFeHByZXNzaW9uKGV4cHI6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgIGxldCB7IHBhdGggfSA9IGV4cHI7XG5cbiAgICBpZiAoaXNMaXRlcmFsKHBhdGgpKSB7XG4gICAgICB0aGlzLm9wY29kZShbJ2xpdGVyYWwnLCBwYXRoLnZhbHVlXSwgZXhwcik7XG4gICAgfSBlbHNlIGlmIChpc0J1aWx0SW5IZWxwZXIocGF0aCkpIHtcbiAgICAgIHRoaXMuYnVpbHRJbkhlbHBlcihleHByIGFzIEFTVC5DYWxsKTtcbiAgICB9IGVsc2UgaWYgKGlzQXJnKHBhdGgpKSB7XG4gICAgICB0aGlzLmFyZyhbcGF0aF0pO1xuICAgIH0gZWxzZSBpZiAoaXNIZWxwZXJJbnZvY2F0aW9uKGV4cHIpKSB7XG4gICAgICB0aGlzLnByZXBhcmVIZWxwZXIoZXhwcik7XG4gICAgICB0aGlzLm9wY29kZShbJ2hlbHBlcicsIHBhdGgucGFydHNbMF1dLCBleHByKTtcbiAgICB9IGVsc2UgaWYgKHBhdGgudGhpcykge1xuICAgICAgdGhpcy5vcGNvZGUoWydnZXQnLCBbMCwgcGF0aC5wYXJ0c11dLCBleHByKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IFtoZWFkLCAuLi5wYXJ0c10gPSBwYXRoLnBhcnRzO1xuICAgICAgdGhpcy5vcGNvZGUoWydtYXliZUdldCcsIFtoZWFkLCBwYXJ0c11dLCBleHByKTtcbiAgICB9XG5cbiAgICAvLyB9IGVsc2UgaWYgKGlzTG9jYWwocGF0aCwgdGhpcy5zeW1ib2xzKSkge1xuICAgIC8vICAgbGV0IFtoZWFkLCAuLi5wYXJ0c10gPSBwYXRoLnBhcnRzO1xuICAgIC8vICAgdGhpcy5vcGNvZGUoWydnZXQnLCBbaGVhZCwgcGFydHNdXSwgZXhwcik7XG4gICAgLy8gfSBlbHNlIGlmIChpc1NpbXBsZVBhdGgocGF0aCkpIHtcbiAgICAvLyAgIHRoaXMub3Bjb2RlKFsndW5rbm93bicsIHBhdGgucGFydHNbMF1dLCBleHByKTtcbiAgICAvLyB9IGVsc2Uge1xuICAgIC8vICAgdGhpcy5vcGNvZGUoWydtYXliZUxvY2FsJywgcGF0aC5wYXJ0c10sIGV4cHIpO1xuICAgIC8vIH1cbiAgfVxuXG4gIC8vLyBJbnRlcm5hbCBTeW50YXhcblxuICB5aWVsZCh0bzogc3RyaW5nLCBhY3Rpb246IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgIHRoaXMucHJlcGFyZVBhcmFtcyhhY3Rpb24ucGFyYW1zKTtcbiAgICB0aGlzLm9wY29kZShbJ3lpZWxkJywgdG9dLCBhY3Rpb24pO1xuICB9XG5cbiAgZGVidWdnZXIoX25hbWU6IHN0cmluZywgYWN0aW9uOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgICB0aGlzLm9wY29kZShbJ2RlYnVnZ2VyJywgbnVsbF0sIGFjdGlvbik7XG4gIH1cblxuICBoYXNCbG9jayhuYW1lOiBzdHJpbmcsIGFjdGlvbjogQVNULkNhbGwpIHtcbiAgICB0aGlzLm9wY29kZShbJ2hhc0Jsb2NrJywgbmFtZV0sIGFjdGlvbik7XG4gIH1cblxuICBoYXNCbG9ja1BhcmFtcyhuYW1lOiBzdHJpbmcsIGFjdGlvbjogQVNULkNhbGwpIHtcbiAgICB0aGlzLm9wY29kZShbJ2hhc0Jsb2NrUGFyYW1zJywgbmFtZV0sIGFjdGlvbik7XG4gIH1cblxuICBwYXJ0aWFsKF9wYXJhbXM6IEFTVC5FeHByZXNzaW9uW10sIGFjdGlvbjogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gICAgdGhpcy5wcmVwYXJlUGFyYW1zKGFjdGlvbi5wYXJhbXMpO1xuICAgIHRoaXMub3Bjb2RlKFsncGFydGlhbCcsIG51bGxdLCBhY3Rpb24pO1xuICB9XG5cbiAgYnVpbHRJbkhlbHBlcihleHByOiBBU1QuQ2FsbCkge1xuICAgIGxldCB7IHBhdGggfSA9IGV4cHI7XG4gICAgaWYgKGlzSGFzQmxvY2socGF0aCkpIHtcbiAgICAgIGxldCBuYW1lID0gYXNzZXJ0VmFsaWRIYXNCbG9ja1VzYWdlKGV4cHIucGF0aC5vcmlnaW5hbCwgZXhwcik7XG4gICAgICB0aGlzLmhhc0Jsb2NrKG5hbWUsIGV4cHIpO1xuICAgIH0gZWxzZSBpZiAoaXNIYXNCbG9ja1BhcmFtcyhwYXRoKSkge1xuICAgICAgbGV0IG5hbWUgPSBhc3NlcnRWYWxpZEhhc0Jsb2NrVXNhZ2UoZXhwci5wYXRoLm9yaWdpbmFsLCBleHByKTtcbiAgICAgIHRoaXMuaGFzQmxvY2tQYXJhbXMobmFtZSwgZXhwcik7XG4gICAgfVxuICB9XG5cbiAgLy8vIEV4cHJlc3Npb25zLCBpbnZva2VkIHJlY3Vyc2l2ZWx5IGZyb20gcHJlcGFyZVBhcmFtcyBhbmQgcHJlcGFyZUhhc2hcblxuICBTdWJFeHByZXNzaW9uKGV4cHI6IEFTVC5TdWJFeHByZXNzaW9uKSB7XG4gICAgaWYgKGlzQnVpbHRJbkhlbHBlcihleHByLnBhdGgpKSB7XG4gICAgICB0aGlzLmJ1aWx0SW5IZWxwZXIoZXhwcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHJlcGFyZUhlbHBlcihleHByKTtcbiAgICAgIHRoaXMub3Bjb2RlKFsnaGVscGVyJywgZXhwci5wYXRoLnBhcnRzWzBdXSwgZXhwcik7XG4gICAgfVxuICB9XG5cbiAgUGF0aEV4cHJlc3Npb24oZXhwcjogQVNULlBhdGhFeHByZXNzaW9uKSB7XG4gICAgaWYgKGV4cHIuZGF0YSkge1xuICAgICAgdGhpcy5hcmcoW2V4cHJdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IFtoZWFkLCAuLi5yZXN0XSA9IGV4cHIucGFydHM7XG5cbiAgICAgIGlmIChleHByLnRoaXMpIHtcbiAgICAgICAgdGhpcy5vcGNvZGUoWydnZXQnLCBbMCwgZXhwci5wYXJ0c11dLCBleHByKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKFsnZ2V0JywgW2hlYWQsIHJlc3RdXSwgZXhwcik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgU3RyaW5nTGl0ZXJhbChhY3Rpb246IEFTVC5TdHJpbmdMaXRlcmFsKSB7XG4gICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywgYWN0aW9uLnZhbHVlXSwgYWN0aW9uKTtcbiAgfVxuXG4gIEJvb2xlYW5MaXRlcmFsKGFjdGlvbjogQVNULkJvb2xlYW5MaXRlcmFsKSB7XG4gICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywgYWN0aW9uLnZhbHVlXSwgYWN0aW9uKTtcbiAgfVxuXG4gIE51bWJlckxpdGVyYWwoYWN0aW9uOiBBU1QuTnVtYmVyTGl0ZXJhbCkge1xuICAgIHRoaXMub3Bjb2RlKFsnbGl0ZXJhbCcsIGFjdGlvbi52YWx1ZV0sIGFjdGlvbik7XG4gIH1cblxuICBOdWxsTGl0ZXJhbChhY3Rpb246IEFTVC5OdWxsTGl0ZXJhbCkge1xuICAgIHRoaXMub3Bjb2RlKFsnbGl0ZXJhbCcsIGFjdGlvbi52YWx1ZV0sIGFjdGlvbik7XG4gIH1cblxuICBVbmRlZmluZWRMaXRlcmFsKGFjdGlvbjogQVNULlVuZGVmaW5lZExpdGVyYWwpIHtcbiAgICB0aGlzLm9wY29kZShbJ2xpdGVyYWwnLCBhY3Rpb24udmFsdWVdLCBhY3Rpb24pO1xuICB9XG5cbiAgLy8vIFV0aWxpdGllc1xuXG4gIG9wY29kZTxPIGV4dGVuZHMgU3ltYm9sSW5PcD4ob3Bjb2RlOiBPLCBhY3Rpb246IE9wdGlvbjxBU1QuQmFzZU5vZGU+ID0gbnVsbCkge1xuICAgIC8vIFRPRE86IFRoaXMgZG9lc24ndCByZWFsbHkgd29ya1xuICAgIGlmICh0aGlzLmluY2x1ZGVNZXRhICYmIGFjdGlvbikge1xuICAgICAgKG9wY29kZSBhcyBhbnkpLnB1c2godGhpcy5tZXRhKGFjdGlvbikpO1xuICAgIH1cblxuICAgIHRoaXMub3Bjb2Rlcy5wdXNoKG9wY29kZSk7XG4gIH1cblxuICBwcmVwYXJlSGVscGVyKGV4cHI6IEFTVC5DYWxsKSB7XG4gICAgYXNzZXJ0SXNTaW1wbGVQYXRoKGV4cHIucGF0aCwgZXhwci5sb2MsICdoZWxwZXInKTtcblxuICAgIGxldCB7IHBhcmFtcywgaGFzaCB9ID0gZXhwcjtcblxuICAgIHRoaXMucHJlcGFyZUhhc2goaGFzaCk7XG4gICAgdGhpcy5wcmVwYXJlUGFyYW1zKHBhcmFtcyk7XG4gIH1cblxuICBwcmVwYXJlUGFyYW1zKHBhcmFtczogQVNULkV4cHJlc3Npb25bXSkge1xuICAgIGlmICghcGFyYW1zLmxlbmd0aCkge1xuICAgICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywgbnVsbF0sIG51bGwpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSBwYXJhbXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGxldCBwYXJhbSA9IHBhcmFtc1tpXTtcblxuICAgICAgYXNzZXJ0KHRoaXNbcGFyYW0udHlwZV0sIGBVbmltcGxlbWVudGVkICR7cGFyYW0udHlwZX0gb24gVGVtcGxhdGVDb21waWxlcmApO1xuICAgICAgKHRoaXNbcGFyYW0udHlwZV0gYXMgYW55KShwYXJhbSk7XG4gICAgfVxuXG4gICAgdGhpcy5vcGNvZGUoWydwcmVwYXJlQXJyYXknLCBwYXJhbXMubGVuZ3RoXSwgbnVsbCk7XG4gIH1cblxuICBwcmVwYXJlSGFzaChoYXNoOiBBU1QuSGFzaCkge1xuICAgIGxldCBwYWlycyA9IGhhc2gucGFpcnM7XG5cbiAgICBpZiAoIXBhaXJzLmxlbmd0aCkge1xuICAgICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywgbnVsbF0sIG51bGwpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSBwYWlycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgbGV0IHsga2V5LCB2YWx1ZSB9ID0gcGFpcnNbaV07XG5cbiAgICAgIGFzc2VydCh0aGlzW3ZhbHVlLnR5cGVdLCBgVW5pbXBsZW1lbnRlZCAke3ZhbHVlLnR5cGV9IG9uIFRlbXBsYXRlQ29tcGlsZXJgKTtcbiAgICAgICh0aGlzW3ZhbHVlLnR5cGVdIGFzIGFueSkodmFsdWUpO1xuICAgICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywga2V5XSwgbnVsbCk7XG4gICAgfVxuXG4gICAgdGhpcy5vcGNvZGUoWydwcmVwYXJlT2JqZWN0JywgcGFpcnMubGVuZ3RoXSwgbnVsbCk7XG4gIH1cblxuICBwcmVwYXJlQXR0cmlidXRlVmFsdWUodmFsdWU6IEFTVC5BdHRyTm9kZVsndmFsdWUnXSkge1xuICAgIC8vIHJldHVybnMgdGhlIHN0YXRpYyB2YWx1ZSBpZiB0aGUgdmFsdWUgaXMgc3RhdGljXG5cbiAgICBzd2l0Y2ggKHZhbHVlLnR5cGUpIHtcbiAgICAgIGNhc2UgJ1RleHROb2RlJzpcbiAgICAgICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywgdmFsdWUuY2hhcnNdLCB2YWx1ZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgY2FzZSAnTXVzdGFjaGVTdGF0ZW1lbnQnOlxuICAgICAgICB0aGlzLmF0dHJpYnV0ZU11c3RhY2hlKFt2YWx1ZV0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICBjYXNlICdDb25jYXRTdGF0ZW1lbnQnOlxuICAgICAgICB0aGlzLnByZXBhcmVDb25jYXRQYXJ0cyh2YWx1ZS5wYXJ0cyk7XG4gICAgICAgIHRoaXMub3Bjb2RlKFsnY29uY2F0JywgbnVsbF0sIHZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByZXBhcmVDb25jYXRQYXJ0cyhwYXJ0czogQVNULkNvbmNhdFN0YXRlbWVudFsncGFydHMnXSkge1xuICAgIGZvciAobGV0IGkgPSBwYXJ0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgbGV0IHBhcnQgPSBwYXJ0c1tpXTtcblxuICAgICAgaWYgKHBhcnQudHlwZSA9PT0gJ011c3RhY2hlU3RhdGVtZW50Jykge1xuICAgICAgICB0aGlzLmF0dHJpYnV0ZU11c3RhY2hlKFtwYXJ0XSk7XG4gICAgICB9IGVsc2UgaWYgKHBhcnQudHlwZSA9PT0gJ1RleHROb2RlJykge1xuICAgICAgICB0aGlzLm9wY29kZShbJ2xpdGVyYWwnLCBwYXJ0LmNoYXJzXSwgbnVsbCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5vcGNvZGUoWydwcmVwYXJlQXJyYXknLCBwYXJ0cy5sZW5ndGhdLCBudWxsKTtcbiAgfVxuXG4gIGF0dHJpYnV0ZU11c3RhY2hlKFthY3Rpb25dOiBbQVNULk11c3RhY2hlU3RhdGVtZW50XSkge1xuICAgIHRoaXMubXVzdGFjaGVFeHByZXNzaW9uKGFjdGlvbik7XG4gIH1cblxuICBtZXRhKG5vZGU6IEFTVC5CYXNlTm9kZSkge1xuICAgIGxldCBsb2MgPSBub2RlLmxvYztcbiAgICBpZiAoIWxvYykge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGxldCB7IHNvdXJjZSwgc3RhcnQsIGVuZCB9ID0gbG9jO1xuICAgIHJldHVybiBbJ2xvYycsIFtzb3VyY2UgfHwgbnVsbCwgW3N0YXJ0LmxpbmUsIHN0YXJ0LmNvbHVtbl0sIFtlbmQubGluZSwgZW5kLmNvbHVtbl1dXTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpc0hlbHBlckludm9jYXRpb24oXG4gIG11c3RhY2hlOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnRcbik6IG11c3RhY2hlIGlzIEFTVC5NdXN0YWNoZVN0YXRlbWVudCAmIHsgcGF0aDogQVNULlBhdGhFeHByZXNzaW9uIH0ge1xuICByZXR1cm4gKFxuICAgIChtdXN0YWNoZS5wYXJhbXMgJiYgbXVzdGFjaGUucGFyYW1zLmxlbmd0aCA+IDApIHx8XG4gICAgKG11c3RhY2hlLmhhc2ggJiYgbXVzdGFjaGUuaGFzaC5wYWlycy5sZW5ndGggPiAwKVxuICApO1xufVxuXG5mdW5jdGlvbiBpc1NpbXBsZVBhdGgoeyBwYXJ0cyB9OiBBU1QuUGF0aEV4cHJlc3Npb24pOiBib29sZWFuIHtcbiAgcmV0dXJuIHBhcnRzLmxlbmd0aCA9PT0gMTtcbn1cblxuZnVuY3Rpb24gaXNZaWVsZChwYXRoOiBBU1QuUGF0aEV4cHJlc3Npb24pIHtcbiAgcmV0dXJuIHBhdGgub3JpZ2luYWwgPT09ICd5aWVsZCc7XG59XG5cbmZ1bmN0aW9uIGlzUGFydGlhbChwYXRoOiBBU1QuUGF0aEV4cHJlc3Npb24pIHtcbiAgcmV0dXJuIHBhdGgub3JpZ2luYWwgPT09ICdwYXJ0aWFsJztcbn1cblxuZnVuY3Rpb24gaXNEZWJ1Z2dlcihwYXRoOiBBU1QuUGF0aEV4cHJlc3Npb24pIHtcbiAgcmV0dXJuIHBhdGgub3JpZ2luYWwgPT09ICdkZWJ1Z2dlcic7XG59XG5cbmZ1bmN0aW9uIGlzSGFzQmxvY2socGF0aDogQVNULlBhdGhFeHByZXNzaW9uKSB7XG4gIHJldHVybiBwYXRoLm9yaWdpbmFsID09PSAnaGFzLWJsb2NrJztcbn1cblxuZnVuY3Rpb24gaXNIYXNCbG9ja1BhcmFtcyhwYXRoOiBBU1QuUGF0aEV4cHJlc3Npb24pIHtcbiAgcmV0dXJuIHBhdGgub3JpZ2luYWwgPT09ICdoYXMtYmxvY2stcGFyYW1zJztcbn1cblxuZnVuY3Rpb24gaXNCdWlsdEluSGVscGVyKHBhdGg6IEFTVC5QYXRoRXhwcmVzc2lvbikge1xuICByZXR1cm4gaXNIYXNCbG9jayhwYXRoKSB8fCBpc0hhc0Jsb2NrUGFyYW1zKHBhdGgpO1xufVxuXG5mdW5jdGlvbiBpc0FyZyhwYXRoOiBBU1QuUGF0aEV4cHJlc3Npb24pOiBib29sZWFuIHtcbiAgcmV0dXJuICEhcGF0aFsnZGF0YSddO1xufVxuXG5mdW5jdGlvbiBpc0R5bmFtaWNDb21wb25lbnQoZWxlbWVudDogQVNULkVsZW1lbnROb2RlKTogYm9vbGVhbiB7XG4gIGxldCBvcGVuID0gZWxlbWVudC50YWcuY2hhckF0KDApO1xuXG4gIGxldCBbbWF5YmVMb2NhbF0gPSBlbGVtZW50LnRhZy5zcGxpdCgnLicpO1xuICBsZXQgaXNOYW1lZEFyZ3VtZW50ID0gb3BlbiA9PT0gJ0AnO1xuICBsZXQgaXNMb2NhbCA9IGVsZW1lbnRbJ3N5bWJvbHMnXS5oYXMobWF5YmVMb2NhbCk7XG4gIGxldCBpc1RoaXNQYXRoID0gZWxlbWVudC50YWcuaW5kZXhPZigndGhpcy4nKSA9PT0gMDtcblxuICByZXR1cm4gaXNMb2NhbCB8fCBpc05hbWVkQXJndW1lbnQgfHwgaXNUaGlzUGF0aDtcbn1cblxuZnVuY3Rpb24gaXNDb21wb25lbnQoZWxlbWVudDogQVNULkVsZW1lbnROb2RlKTogYm9vbGVhbiB7XG4gIGxldCBvcGVuID0gZWxlbWVudC50YWcuY2hhckF0KDApO1xuICBsZXQgaXNQYXRoID0gZWxlbWVudC50YWcuaW5kZXhPZignLicpID4gLTE7XG5cbiAgbGV0IGlzVXBwZXJDYXNlID0gb3BlbiA9PT0gb3Blbi50b1VwcGVyQ2FzZSgpICYmIG9wZW4gIT09IG9wZW4udG9Mb3dlckNhc2UoKTtcblxuICByZXR1cm4gKGlzVXBwZXJDYXNlICYmICFpc1BhdGgpIHx8IGlzRHluYW1pY0NvbXBvbmVudChlbGVtZW50KTtcbn1cblxuZnVuY3Rpb24gYXNzZXJ0SXNTaW1wbGVQYXRoKHBhdGg6IEFTVC5QYXRoRXhwcmVzc2lvbiwgbG9jOiBBU1QuU291cmNlTG9jYXRpb24sIGNvbnRleHQ6IHN0cmluZykge1xuICBpZiAoIWlzU2ltcGxlUGF0aChwYXRoKSkge1xuICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihcbiAgICAgIGBcXGAke3BhdGgub3JpZ2luYWx9XFxgIGlzIG5vdCBhIHZhbGlkIG5hbWUgZm9yIGEgJHtjb250ZXh0fSBvbiBsaW5lICR7bG9jLnN0YXJ0LmxpbmV9LmAsXG4gICAgICBwYXRoLmxvY1xuICAgICk7XG4gIH1cbn1cblxuZnVuY3Rpb24gYXNzZXJ0VmFsaWRZaWVsZChzdGF0ZW1lbnQ6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCk6IHN0cmluZyB7XG4gIGxldCB7IHBhaXJzIH0gPSBzdGF0ZW1lbnQuaGFzaDtcblxuICBpZiAoKHBhaXJzLmxlbmd0aCA9PT0gMSAmJiBwYWlyc1swXS5rZXkgIT09ICd0bycpIHx8IHBhaXJzLmxlbmd0aCA+IDEpIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYHlpZWxkIG9ubHkgdGFrZXMgYSBzaW5nbGUgbmFtZWQgYXJndW1lbnQ6ICd0bydgLCBzdGF0ZW1lbnQubG9jKTtcbiAgfSBlbHNlIGlmIChwYWlycy5sZW5ndGggPT09IDEgJiYgcGFpcnNbMF0udmFsdWUudHlwZSAhPT0gJ1N0cmluZ0xpdGVyYWwnKSB7XG4gICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKGB5b3UgY2FuIG9ubHkgeWllbGQgdG8gYSBsaXRlcmFsIHZhbHVlYCwgc3RhdGVtZW50LmxvYyk7XG4gIH0gZWxzZSBpZiAocGFpcnMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuICdkZWZhdWx0JztcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gKHBhaXJzWzBdLnZhbHVlIGFzIEFTVC5TdHJpbmdMaXRlcmFsKS52YWx1ZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhc3NlcnRWYWxpZFBhcnRpYWwoc3RhdGVtZW50OiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIC8qIDogZXhwciAqLyB7XG4gIGxldCB7IHBhcmFtcywgaGFzaCwgZXNjYXBlZCwgbG9jIH0gPSBzdGF0ZW1lbnQ7XG5cbiAgaWYgKHBhcmFtcyAmJiBwYXJhbXMubGVuZ3RoICE9PSAxKSB7XG4gICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKFxuICAgICAgYFBhcnRpYWwgZm91bmQgd2l0aCBubyBhcmd1bWVudHMuIFlvdSBtdXN0IHNwZWNpZnkgYSB0ZW1wbGF0ZSBuYW1lLiAob24gbGluZSAke1xuICAgICAgICBsb2Muc3RhcnQubGluZVxuICAgICAgfSlgLFxuICAgICAgc3RhdGVtZW50LmxvY1xuICAgICk7XG4gIH0gZWxzZSBpZiAoaGFzaCAmJiBoYXNoLnBhaXJzLmxlbmd0aCA+IDApIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoXG4gICAgICBgcGFydGlhbCBkb2VzIG5vdCB0YWtlIGFueSBuYW1lZCBhcmd1bWVudHMgKG9uIGxpbmUgJHtsb2Muc3RhcnQubGluZX0pYCxcbiAgICAgIHN0YXRlbWVudC5sb2NcbiAgICApO1xuICB9IGVsc2UgaWYgKCFlc2NhcGVkKSB7XG4gICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKFxuICAgICAgYHt7e3BhcnRpYWwgLi4ufX19IGlzIG5vdCBzdXBwb3J0ZWQsIHBsZWFzZSB1c2Uge3twYXJ0aWFsIC4uLn19IGluc3RlYWQgKG9uIGxpbmUgJHtcbiAgICAgICAgbG9jLnN0YXJ0LmxpbmVcbiAgICAgIH0pYCxcbiAgICAgIHN0YXRlbWVudC5sb2NcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIHBhcmFtcztcbn1cblxuZnVuY3Rpb24gYXNzZXJ0VmFsaWRIYXNCbG9ja1VzYWdlKHR5cGU6IHN0cmluZywgY2FsbDogQVNULkNhbGwpOiBzdHJpbmcge1xuICBsZXQgeyBwYXJhbXMsIGhhc2gsIGxvYyB9ID0gY2FsbDtcblxuICBpZiAoaGFzaCAmJiBoYXNoLnBhaXJzLmxlbmd0aCA+IDApIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYCR7dHlwZX0gZG9lcyBub3QgdGFrZSBhbnkgbmFtZWQgYXJndW1lbnRzYCwgY2FsbC5sb2MpO1xuICB9XG5cbiAgaWYgKHBhcmFtcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gJ2RlZmF1bHQnO1xuICB9IGVsc2UgaWYgKHBhcmFtcy5sZW5ndGggPT09IDEpIHtcbiAgICBsZXQgcGFyYW0gPSBwYXJhbXNbMF07XG4gICAgaWYgKHBhcmFtLnR5cGUgPT09ICdTdHJpbmdMaXRlcmFsJykge1xuICAgICAgcmV0dXJuIHBhcmFtLnZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoXG4gICAgICAgIGB5b3UgY2FuIG9ubHkgeWllbGQgdG8gYSBsaXRlcmFsIHZhbHVlIChvbiBsaW5lICR7bG9jLnN0YXJ0LmxpbmV9KWAsXG4gICAgICAgIGNhbGwubG9jXG4gICAgICApO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoXG4gICAgICBgJHt0eXBlfSBvbmx5IHRha2VzIGEgc2luZ2xlIHBvc2l0aW9uYWwgYXJndW1lbnQgKG9uIGxpbmUgJHtsb2Muc3RhcnQubGluZX0pYCxcbiAgICAgIGNhbGwubG9jXG4gICAgKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhc3NlcnRWYWxpZERlYnVnZ2VyVXNhZ2Uoc3RhdGVtZW50OiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgbGV0IHsgcGFyYW1zLCBoYXNoIH0gPSBzdGF0ZW1lbnQ7XG5cbiAgaWYgKGhhc2ggJiYgaGFzaC5wYWlycy5sZW5ndGggPiAwKSB7XG4gICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKGBkZWJ1Z2dlciBkb2VzIG5vdCB0YWtlIGFueSBuYW1lZCBhcmd1bWVudHNgLCBzdGF0ZW1lbnQubG9jKTtcbiAgfVxuXG4gIGlmIChwYXJhbXMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuICdkZWZhdWx0JztcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYGRlYnVnZ2VyIGRvZXMgbm90IHRha2UgYW55IHBvc2l0aW9uYWwgYXJndW1lbnRzYCwgc3RhdGVtZW50LmxvYyk7XG4gIH1cbn1cbiJdfQ==