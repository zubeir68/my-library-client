import SyntaxError from './errors/syntax-error';
// Regex to validate the identifier for block parameters.
// Based on the ID validation regex in Handlebars.
let ID_INVERSE_PATTERN = /[!"#%-,\.\/;->@\[-\^`\{-~]/;
// Checks the element's attributes to see if it uses block params.
// If it does, registers the block params with the program and
// removes the corresponding attributes from the element.
export function parseElementBlockParams(element) {
    let params = parseBlockParams(element);
    if (params) element.blockParams = params;
}
function parseBlockParams(element) {
    let l = element.attributes.length;
    let attrNames = [];
    for (let i = 0; i < l; i++) {
        attrNames.push(element.attributes[i].name);
    }
    let asIndex = attrNames.indexOf('as');
    if (asIndex !== -1 && l > asIndex && attrNames[asIndex + 1].charAt(0) === '|') {
        // Some basic validation, since we're doing the parsing ourselves
        let paramsString = attrNames.slice(asIndex).join(' ');
        if (paramsString.charAt(paramsString.length - 1) !== '|' || paramsString.match(/\|/g).length !== 2) {
            throw new SyntaxError("Invalid block parameters syntax: '" + paramsString + "'", element.loc);
        }
        let params = [];
        for (let i = asIndex + 1; i < l; i++) {
            let param = attrNames[i].replace(/\|/g, '');
            if (param !== '') {
                if (ID_INVERSE_PATTERN.test(param)) {
                    throw new SyntaxError("Invalid identifier for block parameters: '" + param + "' in '" + paramsString + "'", element.loc);
                }
                params.push(param);
            }
        }
        if (params.length === 0) {
            throw new SyntaxError("Cannot use zero block parameters: '" + paramsString + "'", element.loc);
        }
        element.attributes = element.attributes.slice(0, asIndex);
        return params;
    }
    return null;
}
export function childrenFor(node) {
    switch (node.type) {
        case 'Program':
            return node.body;
        case 'ElementNode':
            return node.children;
    }
}
export function appendChild(parent, node) {
    childrenFor(parent).push(node);
}
export function isLiteral(path) {
    return path.type === 'StringLiteral' || path.type === 'BooleanLiteral' || path.type === 'NumberLiteral' || path.type === 'NullLiteral' || path.type === 'UndefinedLiteral';
}
export function printLiteral(literal) {
    if (literal.type === 'UndefinedLiteral') {
        return 'undefined';
    } else {
        return JSON.stringify(literal.value);
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wYWNrYWdlcy9AZ2xpbW1lci9zeW50YXgvbGliL3V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sQUFBVyxpQkFBTSxBQUF1QixBQUFDO0FBRWhELEFBQXlEO0FBQ3pELEFBQWtEO0FBRWxELElBQUksQUFBa0IscUJBQUcsQUFBNEIsQUFBQztBQUV0RCxBQUFrRTtBQUNsRSxBQUE4RDtBQUM5RCxBQUF5RDtBQUV6RCxBQUFNLHdDQUFrQyxBQUF3QjtBQUM5RCxRQUFJLEFBQU0sU0FBRyxBQUFnQixpQkFBQyxBQUFPLEFBQUMsQUFBQztBQUN2QyxRQUFJLEFBQU0sUUFBRSxBQUFPLFFBQUMsQUFBVyxjQUFHLEFBQU0sQUFBQyxBQUMzQztBQUFDO0FBRUQsMEJBQTBCLEFBQXdCO0FBQ2hELFFBQUksQUFBQyxJQUFHLEFBQU8sUUFBQyxBQUFVLFdBQUMsQUFBTSxBQUFDO0FBQ2xDLFFBQUksQUFBUyxZQUFHLEFBQUUsQUFBQztBQUVuQixTQUFLLElBQUksQUFBQyxJQUFHLEFBQUMsR0FBRSxBQUFDLElBQUcsQUFBQyxHQUFFLEFBQUMsQUFBRSxLQUFFO0FBQzFCLEFBQVMsa0JBQUMsQUFBSSxLQUFDLEFBQU8sUUFBQyxBQUFVLFdBQUMsQUFBQyxBQUFDLEdBQUMsQUFBSSxBQUFDLEFBQUM7QUFDNUM7QUFFRCxRQUFJLEFBQU8sVUFBRyxBQUFTLFVBQUMsQUFBTyxRQUFDLEFBQUksQUFBQyxBQUFDO0FBRXRDLFFBQUksQUFBTyxZQUFLLENBQUMsQUFBQyxLQUFJLEFBQUMsSUFBRyxBQUFPLFdBQUksQUFBUyxVQUFDLEFBQU8sVUFBRyxBQUFDLEFBQUMsR0FBQyxBQUFNLE9BQUMsQUFBQyxBQUFDLE9BQUssQUFBRyxLQUFFO0FBQzdFLEFBQWlFO0FBQ2pFLFlBQUksQUFBWSxlQUFHLEFBQVMsVUFBQyxBQUFLLE1BQUMsQUFBTyxBQUFDLFNBQUMsQUFBSSxLQUFDLEFBQUcsQUFBQyxBQUFDO0FBQ3RELFlBQ0UsQUFBWSxhQUFDLEFBQU0sT0FBQyxBQUFZLGFBQUMsQUFBTSxTQUFHLEFBQUMsQUFBQyxPQUFLLEFBQUcsT0FDcEQsQUFBWSxhQUFDLEFBQUssTUFBQyxBQUFLLEFBQUUsT0FBQyxBQUFNLFdBQUssQUFBQyxHQUN2QztBQUNBLGtCQUFNLElBQUksQUFBVyxZQUFDLEFBQW9DLHVDQUFHLEFBQVksZUFBRyxBQUFHLEtBQUUsQUFBTyxRQUFDLEFBQUcsQUFBQyxBQUFDO0FBQy9GO0FBRUQsWUFBSSxBQUFNLFNBQUcsQUFBRSxBQUFDO0FBQ2hCLGFBQUssSUFBSSxBQUFDLElBQUcsQUFBTyxVQUFHLEFBQUMsR0FBRSxBQUFDLElBQUcsQUFBQyxHQUFFLEFBQUMsQUFBRSxLQUFFO0FBQ3BDLGdCQUFJLEFBQUssUUFBRyxBQUFTLFVBQUMsQUFBQyxBQUFDLEdBQUMsQUFBTyxRQUFDLEFBQUssT0FBRSxBQUFFLEFBQUMsQUFBQztBQUM1QyxnQkFBSSxBQUFLLFVBQUssQUFBRSxJQUFFO0FBQ2hCLG9CQUFJLEFBQWtCLG1CQUFDLEFBQUksS0FBQyxBQUFLLEFBQUMsUUFBRTtBQUNsQywwQkFBTSxJQUFJLEFBQVcsWUFDbkIsQUFBNEMsK0NBQUcsQUFBSyxRQUFHLEFBQVEsV0FBRyxBQUFZLGVBQUcsQUFBRyxLQUNwRixBQUFPLFFBQUMsQUFBRyxBQUNaLEFBQUM7QUFDSDtBQUNELEFBQU0sdUJBQUMsQUFBSSxLQUFDLEFBQUssQUFBQyxBQUFDO0FBQ3BCO0FBQ0Y7QUFFRCxZQUFJLEFBQU0sT0FBQyxBQUFNLFdBQUssQUFBQyxHQUFFO0FBQ3ZCLGtCQUFNLElBQUksQUFBVyxZQUNuQixBQUFxQyx3Q0FBRyxBQUFZLGVBQUcsQUFBRyxLQUMxRCxBQUFPLFFBQUMsQUFBRyxBQUNaLEFBQUM7QUFDSDtBQUVELEFBQU8sZ0JBQUMsQUFBVSxhQUFHLEFBQU8sUUFBQyxBQUFVLFdBQUMsQUFBSyxNQUFDLEFBQUMsR0FBRSxBQUFPLEFBQUMsQUFBQztBQUMxRCxlQUFPLEFBQU0sQUFBQztBQUNmO0FBRUQsV0FBTyxBQUFJLEFBQUMsQUFDZDtBQUFDO0FBRUQsQUFBTSw0QkFBc0IsQUFBbUM7QUFDN0QsWUFBUSxBQUFJLEtBQUMsQUFBSSxBQUFFO0FBQ2pCLGFBQUssQUFBUztBQUNaLG1CQUFPLEFBQUksS0FBQyxBQUFJLEFBQUM7QUFDbkIsYUFBSyxBQUFhO0FBQ2hCLG1CQUFPLEFBQUksS0FBQyxBQUFRLEFBQUMsQUFDeEIsQUFDSDs7QUFBQztBQUVELEFBQU0sNEJBQXNCLEFBQXFDLFFBQUUsQUFBbUI7QUFDcEYsQUFBVyxnQkFBQyxBQUFNLEFBQUMsUUFBQyxBQUFJLEtBQUMsQUFBSSxBQUFDLEFBQUMsQUFDakM7QUFBQztBQUVELEFBQU0sMEJBQW9CLEFBQXNDO0FBQzlELEFBQU8sV0FDTCxBQUFJLEtBQUMsQUFBSSxTQUFLLEFBQWUsbUJBQzdCLEFBQUksS0FBQyxBQUFJLFNBQUssQUFBZ0Isb0JBQzlCLEFBQUksS0FBQyxBQUFJLFNBQUssQUFBZSxtQkFDN0IsQUFBSSxLQUFDLEFBQUksU0FBSyxBQUFhLGlCQUMzQixBQUFJLEtBQUMsQUFBSSxTQUFLLEFBQWtCLEFBQ2pDLEFBQUMsQUFDSjtBQUFDO0FBRUQsQUFBTSw2QkFBdUIsQUFBb0I7QUFDL0MsUUFBSSxBQUFPLFFBQUMsQUFBSSxTQUFLLEFBQWtCLG9CQUFFO0FBQ3ZDLGVBQU8sQUFBVyxBQUFDO0FBQ3BCLFdBQU07QUFDTCxlQUFPLEFBQUksS0FBQyxBQUFTLFVBQUMsQUFBTyxRQUFDLEFBQUssQUFBQyxBQUFDO0FBQ3RDLEFBQ0g7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEFTVCBmcm9tICcuL3R5cGVzL25vZGVzJztcbmltcG9ydCB7IE9wdGlvbiB9IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuaW1wb3J0IFN5bnRheEVycm9yIGZyb20gJy4vZXJyb3JzL3N5bnRheC1lcnJvcic7XG5cbi8vIFJlZ2V4IHRvIHZhbGlkYXRlIHRoZSBpZGVudGlmaWVyIGZvciBibG9jayBwYXJhbWV0ZXJzLlxuLy8gQmFzZWQgb24gdGhlIElEIHZhbGlkYXRpb24gcmVnZXggaW4gSGFuZGxlYmFycy5cblxubGV0IElEX0lOVkVSU0VfUEFUVEVSTiA9IC9bIVwiIyUtLFxcLlxcLzstPkBcXFstXFxeYFxcey1+XS87XG5cbi8vIENoZWNrcyB0aGUgZWxlbWVudCdzIGF0dHJpYnV0ZXMgdG8gc2VlIGlmIGl0IHVzZXMgYmxvY2sgcGFyYW1zLlxuLy8gSWYgaXQgZG9lcywgcmVnaXN0ZXJzIHRoZSBibG9jayBwYXJhbXMgd2l0aCB0aGUgcHJvZ3JhbSBhbmRcbi8vIHJlbW92ZXMgdGhlIGNvcnJlc3BvbmRpbmcgYXR0cmlidXRlcyBmcm9tIHRoZSBlbGVtZW50LlxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VFbGVtZW50QmxvY2tQYXJhbXMoZWxlbWVudDogQVNULkVsZW1lbnROb2RlKSB7XG4gIGxldCBwYXJhbXMgPSBwYXJzZUJsb2NrUGFyYW1zKGVsZW1lbnQpO1xuICBpZiAocGFyYW1zKSBlbGVtZW50LmJsb2NrUGFyYW1zID0gcGFyYW1zO1xufVxuXG5mdW5jdGlvbiBwYXJzZUJsb2NrUGFyYW1zKGVsZW1lbnQ6IEFTVC5FbGVtZW50Tm9kZSk6IE9wdGlvbjxzdHJpbmdbXT4ge1xuICBsZXQgbCA9IGVsZW1lbnQuYXR0cmlidXRlcy5sZW5ndGg7XG4gIGxldCBhdHRyTmFtZXMgPSBbXTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgIGF0dHJOYW1lcy5wdXNoKGVsZW1lbnQuYXR0cmlidXRlc1tpXS5uYW1lKTtcbiAgfVxuXG4gIGxldCBhc0luZGV4ID0gYXR0ck5hbWVzLmluZGV4T2YoJ2FzJyk7XG5cbiAgaWYgKGFzSW5kZXggIT09IC0xICYmIGwgPiBhc0luZGV4ICYmIGF0dHJOYW1lc1thc0luZGV4ICsgMV0uY2hhckF0KDApID09PSAnfCcpIHtcbiAgICAvLyBTb21lIGJhc2ljIHZhbGlkYXRpb24sIHNpbmNlIHdlJ3JlIGRvaW5nIHRoZSBwYXJzaW5nIG91cnNlbHZlc1xuICAgIGxldCBwYXJhbXNTdHJpbmcgPSBhdHRyTmFtZXMuc2xpY2UoYXNJbmRleCkuam9pbignICcpO1xuICAgIGlmIChcbiAgICAgIHBhcmFtc1N0cmluZy5jaGFyQXQocGFyYW1zU3RyaW5nLmxlbmd0aCAtIDEpICE9PSAnfCcgfHxcbiAgICAgIHBhcmFtc1N0cmluZy5tYXRjaCgvXFx8L2cpIS5sZW5ndGggIT09IDJcbiAgICApIHtcbiAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihcIkludmFsaWQgYmxvY2sgcGFyYW1ldGVycyBzeW50YXg6ICdcIiArIHBhcmFtc1N0cmluZyArIFwiJ1wiLCBlbGVtZW50LmxvYyk7XG4gICAgfVxuXG4gICAgbGV0IHBhcmFtcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSBhc0luZGV4ICsgMTsgaSA8IGw7IGkrKykge1xuICAgICAgbGV0IHBhcmFtID0gYXR0ck5hbWVzW2ldLnJlcGxhY2UoL1xcfC9nLCAnJyk7XG4gICAgICBpZiAocGFyYW0gIT09ICcnKSB7XG4gICAgICAgIGlmIChJRF9JTlZFUlNFX1BBVFRFUk4udGVzdChwYXJhbSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoXG4gICAgICAgICAgICBcIkludmFsaWQgaWRlbnRpZmllciBmb3IgYmxvY2sgcGFyYW1ldGVyczogJ1wiICsgcGFyYW0gKyBcIicgaW4gJ1wiICsgcGFyYW1zU3RyaW5nICsgXCInXCIsXG4gICAgICAgICAgICBlbGVtZW50LmxvY1xuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcGFyYW1zLnB1c2gocGFyYW0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChwYXJhbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoXG4gICAgICAgIFwiQ2Fubm90IHVzZSB6ZXJvIGJsb2NrIHBhcmFtZXRlcnM6ICdcIiArIHBhcmFtc1N0cmluZyArIFwiJ1wiLFxuICAgICAgICBlbGVtZW50LmxvY1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBlbGVtZW50LmF0dHJpYnV0ZXMgPSBlbGVtZW50LmF0dHJpYnV0ZXMuc2xpY2UoMCwgYXNJbmRleCk7XG4gICAgcmV0dXJuIHBhcmFtcztcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2hpbGRyZW5Gb3Iobm9kZTogQVNULlByb2dyYW0gfCBBU1QuRWxlbWVudE5vZGUpOiBBU1QuU3RhdGVtZW50W10ge1xuICBzd2l0Y2ggKG5vZGUudHlwZSkge1xuICAgIGNhc2UgJ1Byb2dyYW0nOlxuICAgICAgcmV0dXJuIG5vZGUuYm9keTtcbiAgICBjYXNlICdFbGVtZW50Tm9kZSc6XG4gICAgICByZXR1cm4gbm9kZS5jaGlsZHJlbjtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gYXBwZW5kQ2hpbGQocGFyZW50OiBBU1QuUHJvZ3JhbSB8IEFTVC5FbGVtZW50Tm9kZSwgbm9kZTogQVNULlN0YXRlbWVudCkge1xuICBjaGlsZHJlbkZvcihwYXJlbnQpLnB1c2gobm9kZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0xpdGVyYWwocGF0aDogQVNULlBhdGhFeHByZXNzaW9uIHwgQVNULkxpdGVyYWwpOiBwYXRoIGlzIEFTVC5MaXRlcmFsIHtcbiAgcmV0dXJuIChcbiAgICBwYXRoLnR5cGUgPT09ICdTdHJpbmdMaXRlcmFsJyB8fFxuICAgIHBhdGgudHlwZSA9PT0gJ0Jvb2xlYW5MaXRlcmFsJyB8fFxuICAgIHBhdGgudHlwZSA9PT0gJ051bWJlckxpdGVyYWwnIHx8XG4gICAgcGF0aC50eXBlID09PSAnTnVsbExpdGVyYWwnIHx8XG4gICAgcGF0aC50eXBlID09PSAnVW5kZWZpbmVkTGl0ZXJhbCdcbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByaW50TGl0ZXJhbChsaXRlcmFsOiBBU1QuTGl0ZXJhbCk6IHN0cmluZyB7XG4gIGlmIChsaXRlcmFsLnR5cGUgPT09ICdVbmRlZmluZWRMaXRlcmFsJykge1xuICAgIHJldHVybiAndW5kZWZpbmVkJztcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobGl0ZXJhbC52YWx1ZSk7XG4gIH1cbn1cbiJdfQ==