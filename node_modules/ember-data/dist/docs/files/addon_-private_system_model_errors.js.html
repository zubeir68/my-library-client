<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addon/-private/system/model/errors.js - The ember-data API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="The ember-data API" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: v3.4.3</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/DS.html">DS</a></li>
                                <li><a href="../classes/DS.AbortError.html">DS.AbortError</a></li>
                                <li><a href="../classes/DS.Adapter.html">DS.Adapter</a></li>
                                <li><a href="../classes/DS.AdapterError.html">DS.AdapterError</a></li>
                                <li><a href="../classes/DS.AdapterPopulatedRecordArray.html">DS.AdapterPopulatedRecordArray</a></li>
                                <li><a href="../classes/DS.BelongsToReference.html">DS.BelongsToReference</a></li>
                                <li><a href="../classes/DS.BooleanTransform.html">DS.BooleanTransform</a></li>
                                <li><a href="../classes/DS.BuildURLMixin.html">DS.BuildURLMixin</a></li>
                                <li><a href="../classes/DS.ConflictError.html">DS.ConflictError</a></li>
                                <li><a href="../classes/DS.DateTransform.html">DS.DateTransform</a></li>
                                <li><a href="../classes/DS.EmbeddedRecordsMixin.html">DS.EmbeddedRecordsMixin</a></li>
                                <li><a href="../classes/DS.Ember.HTMLBars.helpers.html">DS.Ember.HTMLBars.helpers</a></li>
                                <li><a href="../classes/DS.Errors.html">DS.Errors</a></li>
                                <li><a href="../classes/DS.ForbiddenError.html">DS.ForbiddenError</a></li>
                                <li><a href="../classes/DS.HasManyReference.html">DS.HasManyReference</a></li>
                                <li><a href="../classes/DS.InvalidError.html">DS.InvalidError</a></li>
                                <li><a href="../classes/DS.JSONAPIAdapter.html">DS.JSONAPIAdapter</a></li>
                                <li><a href="../classes/DS.JSONAPISerializer.html">DS.JSONAPISerializer</a></li>
                                <li><a href="../classes/DS.JSONSerializer.html">DS.JSONSerializer</a></li>
                                <li><a href="../classes/DS.ManyArray.html">DS.ManyArray</a></li>
                                <li><a href="../classes/DS.Model.html">DS.Model</a></li>
                                <li><a href="../classes/DS.NotFoundError.html">DS.NotFoundError</a></li>
                                <li><a href="../classes/DS.NumberTransform.html">DS.NumberTransform</a></li>
                                <li><a href="../classes/DS.PromiseArray.html">DS.PromiseArray</a></li>
                                <li><a href="../classes/DS.PromiseManyArray.html">DS.PromiseManyArray</a></li>
                                <li><a href="../classes/DS.PromiseObject.html">DS.PromiseObject</a></li>
                                <li><a href="../classes/DS.RecordArray.html">DS.RecordArray</a></li>
                                <li><a href="../classes/DS.RecordArrayManager.html">DS.RecordArrayManager</a></li>
                                <li><a href="../classes/DS.RecordReference.html">DS.RecordReference</a></li>
                                <li><a href="../classes/DS.RESTAdapter.html">DS.RESTAdapter</a></li>
                                <li><a href="../classes/DS.RESTSerializer.html">DS.RESTSerializer</a></li>
                                <li><a href="../classes/DS.RootState.html">DS.RootState</a></li>
                                <li><a href="../classes/DS.Serializer.html">DS.Serializer</a></li>
                                <li><a href="../classes/DS.ServerError.html">DS.ServerError</a></li>
                                <li><a href="../classes/DS.Snapshot.html">DS.Snapshot</a></li>
                                <li><a href="../classes/DS.SnapshotRecordArray.html">DS.SnapshotRecordArray</a></li>
                                <li><a href="../classes/DS.Store.html">DS.Store</a></li>
                                <li><a href="../classes/DS.String.html">DS.String</a></li>
                                <li><a href="../classes/DS.StringTransform.html">DS.StringTransform</a></li>
                                <li><a href="../classes/DS.TimeoutError.html">DS.TimeoutError</a></li>
                                <li><a href="../classes/DS.Transform.html">DS.Transform</a></li>
                                <li><a href="../classes/DS.UnauthorizedError.html">DS.UnauthorizedError</a></li>
                                <li><a href="../classes/Ember.HTMLBars.helpers.html">Ember.HTMLBars.helpers</a></li>
                                <li><a href="../classes/Ember.Inflector.html">Ember.Inflector</a></li>
                                <li><a href="../classes/IdentityMap.html">IdentityMap</a></li>
                                <li><a href="../classes/InternalModelMap.html">InternalModelMap</a></li>
                                <li><a href="../classes/RelationshipPayloads.html">RelationshipPayloads</a></li>
                                <li><a href="../classes/RelationshipPayloadsManager.html">RelationshipPayloadsManager</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ember-data.html">ember-data</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: addon/-private/system/model/errors.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import { mapBy, not } from &#x27;@ember/object/computed&#x27;;
import Evented from &#x27;@ember/object/evented&#x27;;
import ArrayProxy from &#x27;@ember/array/proxy&#x27;;
import { set, get, computed } from &#x27;@ember/object&#x27;;
import { makeArray, A } from &#x27;@ember/array&#x27;;
import MapWithDefault from &#x27;../map-with-default&#x27;;
import { warn } from &#x27;@ember/debug&#x27;;

/**
@module ember-data
*/

/**
  Holds validation errors for a given record, organized by attribute names.

  Every &#x60;DS.Model&#x60; has an &#x60;errors&#x60; property that is an instance of
  &#x60;DS.Errors&#x60;. This can be used to display validation error
  messages returned from the server when a &#x60;record.save()&#x60; rejects.

  For Example, if you had a &#x60;User&#x60; model that looked like this:

  &#x60;&#x60;&#x60;app/models/user.js
  import DS from &#x27;ember-data&#x27;;

  export default DS.Model.extend({
    username: DS.attr(&#x27;string&#x27;),
    email: DS.attr(&#x27;string&#x27;)
  });
  &#x60;&#x60;&#x60;
  And you attempted to save a record that did not validate on the backend:

  &#x60;&#x60;&#x60;javascript
  let user = store.createRecord(&#x27;user&#x27;, {
    username: &#x27;tomster&#x27;,
    email: &#x27;invalidEmail&#x27;
  });
  user.save();
  &#x60;&#x60;&#x60;

  Your backend would be expected to return an error response that described
  the problem, so that error messages can be generated on the app.

  API responses will be translated into instances of &#x60;DS.Errors&#x60; differently,
  depending on the specific combination of adapter and serializer used. You
  may want to check the documentation or the source code of the libraries
  that you are using, to know how they expect errors to be communicated.

  Errors can be displayed to the user by accessing their property name
  to get an array of all the error objects for that property. Each
  error object is a JavaScript object with two keys:

  - &#x60;message&#x60; A string containing the error message from the backend
  - &#x60;attribute&#x60; The name of the property associated with this error message

  &#x60;&#x60;&#x60;handlebars
  &lt;label&gt;Username: {{input value=username}} &lt;/label&gt;
  {{#each model.errors.username as |error|}}
    &lt;div class=&quot;error&quot;&gt;
      {{error.message}}
    &lt;/div&gt;
  {{/each}}

  &lt;label&gt;Email: {{input value=email}} &lt;/label&gt;
  {{#each model.errors.email as |error|}}
    &lt;div class=&quot;error&quot;&gt;
      {{error.message}}
    &lt;/div&gt;
  {{/each}}
  &#x60;&#x60;&#x60;

  You can also access the special &#x60;messages&#x60; property on the error
  object to get an array of all the error strings.

  &#x60;&#x60;&#x60;handlebars
  {{#each model.errors.messages as |message|}}
    &lt;div class=&quot;error&quot;&gt;
      {{message}}
    &lt;/div&gt;
  {{/each}}
  &#x60;&#x60;&#x60;

  @class Errors
  @namespace DS
  @extends Ember.Object
  @uses Ember.Enumerable
  @uses Ember.Evented
 */
export default ArrayProxy.extend(Evented, {
  /**
    Register with target handler

    @method _registerHandlers
    @private
  */
  _registerHandlers(target, becameInvalid, becameValid) {
    this.on(&#x27;becameInvalid&#x27;, target, becameInvalid);
    this.on(&#x27;becameValid&#x27;, target, becameValid);
  },

  /**
    @property errorsByAttributeName
    @type {MapWithDefault}
    @private
  */
  errorsByAttributeName: computed(function() {
    return new MapWithDefault({
      defaultValue() {
        return A();
      },
    });
  }),

  /**
    Returns errors for a given attribute

    &#x60;&#x60;&#x60;javascript
    let user = store.createRecord(&#x27;user&#x27;, {
      username: &#x27;tomster&#x27;,
      email: &#x27;invalidEmail&#x27;
    });
    user.save().catch(function(){
      user.get(&#x27;errors&#x27;).errorsFor(&#x27;email&#x27;); // returns:
      // [{attribute: &quot;email&quot;, message: &quot;Doesn&#x27;t look like a valid email.&quot;}]
    });
    &#x60;&#x60;&#x60;

    @method errorsFor
    @param {String} attribute
    @return {Array}
  */
  errorsFor(attribute) {
    return get(this, &#x27;errorsByAttributeName&#x27;).get(attribute);
  },

  /**
    An array containing all of the error messages for this
    record. This is useful for displaying all errors to the user.

    &#x60;&#x60;&#x60;handlebars
    {{#each model.errors.messages as |message|}}
      &lt;div class=&quot;error&quot;&gt;
        {{message}}
      &lt;/div&gt;
    {{/each}}
    &#x60;&#x60;&#x60;

    @property messages
    @type {Array}
  */
  messages: mapBy(&#x27;content&#x27;, &#x27;message&#x27;),

  /**
    @property content
    @type {Array}
    @private
  */
  content: computed(function() {
    return A();
  }),

  /**
    @method unknownProperty
    @private
  */
  unknownProperty(attribute) {
    let errors = this.errorsFor(attribute);
    if (errors.length === 0) {
      return undefined;
    }
    return errors;
  },

  /**
    Total number of errors.

    @property length
    @type {Number}
    @readOnly
  */

  /**
    @property isEmpty
    @type {Boolean}
    @readOnly
  */
  isEmpty: not(&#x27;length&#x27;).readOnly(),

  /**
    Adds error messages to a given attribute and sends
    &#x60;becameInvalid&#x60; event to the record.

    Example:

    &#x60;&#x60;&#x60;javascript
    if (!user.get(&#x27;username&#x27;) {
      user.get(&#x27;errors&#x27;).add(&#x27;username&#x27;, &#x27;This field is required&#x27;);
    }
    &#x60;&#x60;&#x60;

    @method add
    @param {String} attribute
    @param {(Array|String)} messages
    @deprecated
  */
  add(attribute, messages) {
    warn(&#x60;Interacting with a record errors object will no longer change the record state.&#x60;, false, {
      id: &#x27;ds.errors.add&#x27;,
    });

    let wasEmpty = get(this, &#x27;isEmpty&#x27;);

    this._add(attribute, messages);

    if (wasEmpty &amp;&amp; !get(this, &#x27;isEmpty&#x27;)) {
      this.trigger(&#x27;becameInvalid&#x27;);
    }
  },

  /**
    Adds error messages to a given attribute without sending event.

    @method _add
    @private
  */
  _add(attribute, messages) {
    messages = this._findOrCreateMessages(attribute, messages);
    this.addObjects(messages);
    get(this, &#x27;errorsByAttributeName&#x27;)
      .get(attribute)
      .addObjects(messages);

    this.notifyPropertyChange(attribute);
  },

  /**
    @method _findOrCreateMessages
    @private
  */
  _findOrCreateMessages(attribute, messages) {
    let errors = this.errorsFor(attribute);
    let messagesArray = makeArray(messages);
    let _messages = new Array(messagesArray.length);

    for (let i = 0; i &lt; messagesArray.length; i++) {
      let message = messagesArray[i];
      let err = errors.findBy(&#x27;message&#x27;, message);
      if (err) {
        _messages[i] = err;
      } else {
        _messages[i] = {
          attribute: attribute,
          message: message,
        };
      }
    }

    return _messages;
  },

  /**
    Removes all error messages from the given attribute and sends
    &#x60;becameValid&#x60; event to the record if there no more errors left.

    Example:

    &#x60;&#x60;&#x60;app/models/user.js
    import DS from &#x27;ember-data&#x27;;

    export default DS.Model.extend({
      email: DS.attr(&#x27;string&#x27;),
      twoFactorAuth: DS.attr(&#x27;boolean&#x27;),
      phone: DS.attr(&#x27;string&#x27;)
    });
    &#x60;&#x60;&#x60;

    &#x60;&#x60;&#x60;app/routes/user/edit.js
    import Route from &#x27;@ember/routing/route&#x27;;

    export default Route.extend({
      actions: {
        save: function(user) {
          if (!user.get(&#x27;twoFactorAuth&#x27;)) {
            user.get(&#x27;errors&#x27;).remove(&#x27;phone&#x27;);
          }
          user.save();
        }
      }
    });
    &#x60;&#x60;&#x60;

    @method remove
    @param {String} attribute
    @deprecated
  */
  remove(attribute) {
    warn(&#x60;Interacting with a record errors object will no longer change the record state.&#x60;, false, {
      id: &#x27;ds.errors.remove&#x27;,
    });

    if (get(this, &#x27;isEmpty&#x27;)) {
      return;
    }

    this._remove(attribute);

    if (get(this, &#x27;isEmpty&#x27;)) {
      this.trigger(&#x27;becameValid&#x27;);
    }
  },

  /**
    Removes all error messages from the given attribute without sending event.

    @method _remove
    @private
  */
  _remove(attribute) {
    if (get(this, &#x27;isEmpty&#x27;)) {
      return;
    }

    let content = this.rejectBy(&#x27;attribute&#x27;, attribute);
    set(this, &#x27;content&#x27;, content);
    get(this, &#x27;errorsByAttributeName&#x27;).delete(attribute);

    this.notifyPropertyChange(attribute);
    this.notifyPropertyChange(&#x27;length&#x27;);
  },

  /**
    Removes all error messages and sends &#x60;becameValid&#x60; event
    to the record.

    Example:

    &#x60;&#x60;&#x60;app/routes/user/edit.js
  import Route from &#x27;@ember/routing/route&#x27;;

    export default Route.extend({
      actions: {
        retrySave: function(user) {
          user.get(&#x27;errors&#x27;).clear();
          user.save();
        }
      }
    });
    &#x60;&#x60;&#x60;

    @method clear
    @deprecated
  */
  clear() {
    warn(&#x60;Interacting with a record errors object will no longer change the record state.&#x60;, false, {
      id: &#x27;ds.errors.clear&#x27;,
    });

    if (get(this, &#x27;isEmpty&#x27;)) {
      return;
    }

    this._clear();
    this.trigger(&#x27;becameValid&#x27;);
  },

  /**
    Removes all error messages.
    to the record.

    @method _clear
    @private
  */
  _clear() {
    if (get(this, &#x27;isEmpty&#x27;)) {
      return;
    }

    let errorsByAttributeName = get(this, &#x27;errorsByAttributeName&#x27;);
    let attributes = A();

    errorsByAttributeName.forEach(function(_, attribute) {
      attributes.push(attribute);
    });

    errorsByAttributeName.clear();
    attributes.forEach(function(attribute) {
      this.notifyPropertyChange(attribute);
    }, this);

    ArrayProxy.prototype.clear.call(this);
  },

  /**
    Checks if there are error messages for the given attribute.

    &#x60;&#x60;&#x60;app/routes/user/edit.js
    import Route from &#x27;@ember/routing/route&#x27;;

    export default Route.extend({
      actions: {
        save: function(user) {
          if (user.get(&#x27;errors&#x27;).has(&#x27;email&#x27;)) {
            return alert(&#x27;Please update your email before attempting to save.&#x27;);
          }
          user.save();
        }
      }
    });
    &#x60;&#x60;&#x60;

    @method has
    @param {String} attribute
    @return {Boolean} true if there some errors on given attribute
  */
  has(attribute) {
    return this.errorsFor(attribute).length &gt; 0;
  },
});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
